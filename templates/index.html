<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Yazar İşbirliği Ağı</title>
    <script type="text/javascript" src="https://unpkg.com/vis-network@9.1.2/dist/vis-network.min.js"></script>
    <link href="https://unpkg.com/vis-network@9.1.2/dist/vis-network.min.css" rel="stylesheet" />
    <style>
        /* Genel Stil */
        body, html { margin: 0; padding: 0; height: 100%; display: flex; font-family: Arial, sans-serif; overflow: hidden; }
        #output {
            width: 20%; background-color: #f9f9f9; border-right: 1px solid #ccc;
            display: flex; flex-direction: column; padding: 10px;
            overflow-y: auto;
        }
        #network { flex: 1; height: 100vh; border: 1px solid lightgray; }
        #controls {
            width: 20%; position: fixed; top: 0; right: 0; height: 100vh;
            overflow-y: auto; background-color: #f9f9f9; border-left: 1px solid #ccc; padding: 10px;
            display: flex; flex-direction: column; gap: 15px;
        }
        h3 { margin-bottom: 10px; }
        button {
            width: 100%; padding: 8px; font-weight: bold; background-color: #4CAF50; color: white;
            border: none; border-radius: 3px; cursor: pointer; margin-top: 5px;
        }
        button:hover { background-color: #45a049; }
        input {
            width: 100%; padding: 5px; margin: 5px 0; border: 1px solid #ccc; border-radius: 3px;
        }
        .queue-animation {
            background-color: #FFDD57;
            color: black;
            padding: 5px;
            margin: 5px 0;
            border: 1px solid #333;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <!-- Sol Çıktı Ekranı -->
    <div id="output">
        <h2>ÇIKTI EKRANI</h2>
        <div id="output-content">Sonuçlar burada gösterilecek.</div>
    </div>

    <!-- Orta Grafik Alanı -->
    <div id="network"></div>

    <!-- Sağ Kontrol Paneli -->
    <div id="controls">
        <h2>İsterler</h2>
        <h3>1. En Kısa Yol Bulma</h3>
        <input type="text" id="author_a" placeholder="A Yazar Adı">
        <input type="text" id="author_b" placeholder="B Yazar Adı">
        <button onclick="processRequest('shortest_path', 'author_a', 'author_b')">En Kısa Yolu Bul</button>

        <h3>2. Queue Oluştur</h3>
        <input type="text" id="author_queue" placeholder="A Yazar Adı">
        <button onclick="processQueue('priority_queue', 'author_queue')">Queue'yu Oluştur</button>

        <h3>3. BST Oluştur</h3>
        <input type="text" id="author_bst" placeholder="A Yazar Adı">
        <button onclick="processRequest('create_bst', 'author_bst')">BST'yi Oluştur</button>

        <h3>4. Kısa Yollar Hesapla</h3>
        <input type="text" id="author_shortest_all" placeholder="A Yazar Adı">
        <button onclick="processRequest('shortest_paths_all', 'author_shortest_all')">Kısa Yolları Hesapla</button>

        <h3>5. Yazar Sayısını Hesapla</h3>
        <input type="text" id="author_count" placeholder="A Yazar Adı">
        <button onclick="processRequest('count_collaborators', 'author_count')">Yazar Sayısını Hesapla</button>

        <h3>6. En Çok İşbirliği Yapan Yazar</h3>
        <button onclick="processRequest('most_collaborative_author')">En Çok İşbirliği Yapan Yazar</button>

        <h3>7. En Uzun Yol Bul</h3>
        <input type="text" id="author_longest" placeholder="A Yazar Adı">
        <button onclick="processRequest('longest_path', 'author_longest')">En Uzun Yolu Bul</button>
    </div>

    <!-- JavaScript -->
    <script>
        // Kuyruk işlemlerini canlı göstermek için
        function processQueue(action, inputId) {
            const input = document.getElementById(inputId)?.value || '';
            fetch('/process_request', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ action: action, author_a: input })
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'success') {
                    showQueueAnimation(data.queue_steps);
                    document.getElementById('output-content').innerHTML = `<b>${data.result}</b>`;
                } else {
                    document.getElementById('output-content').innerHTML = `<b>Hata:</b> ${data.result}`;
                }
            })
            .catch(error => {
                console.error('Hata:', error);
                document.getElementById('output-content').innerHTML = "Sunucu hatası!";
            });
        }

        function showQueueAnimation(queueSteps) {
            const outputContent = document.getElementById('output-content');
            outputContent.innerHTML = ''; // Önceki içeriği temizle
            queueSteps.forEach((step, index) => {
                setTimeout(() => {
                    const queueItem = document.createElement('div');
                    queueItem.className = 'queue-animation';
                    queueItem.innerText = step;
                    outputContent.appendChild(queueItem);
                }, index * 1000); // Her bir elemanı 1 saniye aralıkla göster
            });
        }

        // Sunucuya istek gönderme
        function processRequest(action, inputId1, inputId2 = null) {
            const input1 = document.getElementById(inputId1)?.value || '';
            const input2 = inputId2 ? document.getElementById(inputId2)?.value || '' : '';

            fetch('/process_request', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ action: action, author_a: input1, author_b: input2 })
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('output-content').innerHTML = data.status === 'success'
                    ? `<b>${data.result}</b>`
                    : `<b>Hata:</b> ${data.result}`;
            })
            .catch(error => {
                console.error('Hata:', error);
                document.getElementById('output-content').innerHTML = "Sunucu hatası!";
            });
        }

        // Grafiği oluşturma
        document.addEventListener("DOMContentLoaded", function () {
            fetch("/get_graph_data")
                .then(response => response.json())
                .then(graphData => {
                    const container = document.getElementById("network");
                    const nodes = new vis.DataSet(graphData.nodes);
                    const edges = new vis.DataSet(graphData.edges);

                    const options = {
                        nodes: { shape: "dot", scaling: { min: 10, max: 30 } },
                        edges: { color: { color: "#848484", highlight: "#3c3c3c" } },
                        physics: { enabled: true, solver: "forceAtlas2Based" },
                        layout: { improvedLayout: true }
                    };
                    new vis.Network(container, { nodes, edges }, options);
                })
                .catch(error => console.error("Grafik verisi yüklenirken hata oluştu:", error));
        });
    </script>
</body>
</html>
